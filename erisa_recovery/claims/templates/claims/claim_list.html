<!-- claims/templates/claims/claim_list.html -->

{% extends "claims/base.html" %}

{% block content %}
<div x-data="{ isModalOpen: false }" @open-modal.window="isModalOpen = true">

    <div class="bg-white p-6 rounded-lg shadow-lg">
        <h2 class="text-2xl font-semibold mb-4 text-gray-800">Claims Dashboard</h2>
        
        <!-- Search and Filter Form (No Changes) -->
        <form hx-get="{% url 'claim_list' %}" hx-target="#claims-table-container" hx-trigger="submit, keyup changed delay:500ms" hx-push-url="true" class="mb-6 space-y-4 md:space-y-0 md:flex md:space-x-4 items-center">
            
            <!-- ... form inputs ... -->
            <div class="flex-grow">
                <input type="text" name="patient_name" value="{{ current_patient_name|default:'' }}" placeholder="Search by patient name..." class="w-full px-4 py-2 border rounded-lg">
            </div>
            <div x-data="{ open: false }" class="relative">
                <button @click="open = !open" type="button" class="px-4 py-2 w-full md:w-auto bg-gray-200 text-gray-700 rounded-lg">Filters</button>
                <div x-show="open" @click.away="open = false" class="absolute right-0 mt-2 w-64 bg-white border rounded-lg shadow-xl z-10 p-4 space-y-3" x-cloak>
                    <div>
                        <label for="insurer" class="block text-sm font-medium">Insurer</label>
                        <select name="insurer" id="insurer" class="mt-1 block w-full pl-3 pr-10 py-2 border-gray-300 rounded-md">
                            <option value="">All</option>
                            {% for insurer_name in insurers %}
                            <option value="{{ insurer_name }}" {% if insurer_name == current_insurer %}selected{% endif %}>{{ insurer_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label for="status" class="block text-sm font-medium">Status</label>
                        <select name="status" id="status" class="mt-1 block w-full pl-3 pr-10 py-2 border-gray-300 rounded-md">
                            <option value="">All</option>
                            {% for status_val, status_display in status_choices %}
                            <option value="{{ status_val }}" {% if status_val == current_status %}selected{% endif %}>{{ status_display }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>
            <button type="submit" class="w-full md:w-auto px-6 py-2 bg-blue-600 text-white rounded-lg">Search</button>
        </form>

        <!-- 
          ** THIS IS THE CORRECTED SECTION **
          - Remove the duplicate div.
          - Add the hx-trigger and hx-swap attributes to this single div.
        -->
        <div id="claims-table-container" 
             hx-trigger="load, claimUpdated from:body" 
             hx-swap="innerHTML">
            {% include "claims/partials/claims_table.html" %}
        </div>
        
    </div>
    
    <!-- Modal Structure (No Changes) -->
    <div x-show="isModalOpen" x-cloak class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50" @keydown.escape.window="isModalOpen = false">
        <!-- ... modal content ... -->
        <div @click.away="isModalOpen = false" class="bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4">
            <div class="flex justify-between items-center p-4 border-b">
                <h3 class="text-xl font-semibold text-gray-800">Claim Details</h3>
                <button @click="isModalOpen = false" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            </div>
            <div id="modal-content">
                <div class="p-8 text-center text-gray-500">Loading details...</div>
            </div>
        </div>
    </div>

</div>
{% endblock %}```

